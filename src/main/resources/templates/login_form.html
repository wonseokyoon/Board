<!DOCTYPE html>
<html lang="en" layout:decorate="~{layout}" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
  <meta charset="UTF-8">
  <title>로그인</title>
</head>
<body>
<div layout:fragment="content" class="container my-3">
  <form th:action="@{/user/login}" method="post">
    <div th:if="${param.error}">
      <div class="alert alert-danger">
        사용자ID 또는 비밀번호를 확인해 주세요.
      </div>
    </div>
    <div class="mb-3">
      <label for="username" class="form-label">사용자ID</label>
      <input type="text" name="username" id="username" class="form-control">
    </div>
    <div class="mb-3">
      <label for="password" class="form-label">비밀번호</label>
      <input type="password" name="password" id="password" class="form-control">
    </div>
    <button type="submit" class="btn btn-primary">로그인</button>
  </form>
</div>
<script>
  document.getElementById('login-form').onsubmit = async function(e) {
    e.preventDefault(); // 기본 폼 제출 동작을 차단합니다.

    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;

    try {
      const response = await fetch('/user/login', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded', // 혹은 'application/json'
        },
        body: new URLSearchParams({ username, password }) // URL 인코딩된 데이터
      });

      if (!response.ok) {
        document.getElementById('error-message').style.display = 'block'; // 오류 메시지 표시
        throw new Error("로그인에 실패했습니다.");
      }

      const token = await response.text(); // 응답으로 JWT 토큰을 가져옵니다.
      console.log("발급받은 JWT 토큰:", token); // 콘솔에 토큰 출력
      // 이후의 처리를 추가할 수 있습니다.
    } catch (error) {
      console.error(error);
    }
  };
</script>
</body>
</html>